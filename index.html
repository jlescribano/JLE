<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario FC Barcelona</title>
    <style>
        /* --- ESTILOS (CSS) --- */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #f4f4f4; 
            padding: 20px; 
            color: #333;
        }
        
        #partidos { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 20px; 
            justify-content: center; 
        }

        #masc-list, #fem-list { flex: 1; min-width: 320px; max-width: 500px; }
        
        h3 { 
            text-align: center; 
            color: #004d98; 
            text-transform: uppercase; 
            border-bottom: 3px solid #a50044; 
            padding-bottom: 10px; 
        }

        .match-card { 
            display: flex; 
            align-items: center; 
            background: #fff; 
            padding: 15px; 
            border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            margin-bottom: 15px;
            border-left: 6px solid #004d98; 
            transition: transform 0.2s;
            position: relative;
        }
        
        .match-card:hover { transform: translateY(-3px); }

        /* Estilo para el equipo femenino */
        .match-card.femenino { border-left-color: #a50044; background: #fff9fb; }

        /* ALERTA VISUAL: Si el partido es hoy */
        .match-today {
            border: 2px solid #ffcc00 !important; /* Dorado */
            background: linear-gradient(135deg, #fff 0%, #fff4d1 100%) !important;
            animation: pulse-border 2s infinite;
        }

        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(255, 204, 0, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 204, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 204, 0, 0); }
        }

        .logo-container { width: 55px; text-align: center; }
        .team-logo { width: 45px; height: auto; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1)); }

        .match-info { flex: 1; text-align: center; padding: 0 10px; }
        
        .date-badge { font-size: 0.8rem; color: #777; font-weight: bold; }
        .teams-line { font-weight: bold; margin: 5px 0; color: #154284; font-size: 1.1rem; }
        .venue-line { font-size: 0.85rem; color: #555; }
        .countdown-text { 
            font-size: 0.8rem; 
            font-weight: bold; 
            color: #a50044; 
            margin-top: 8px; 
            text-transform: uppercase; 
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>

    <h1 style="text-align: center; color: #004d98;">üîµüî¥ Pr√≥ximos Partidos Bar√ßa</h1>

    <div id="partidos">
        <p>Iniciando sistema y cargando calendario...</p>
    </div>

    <script>
        /* --- L√ìGICA (JAVASCRIPT) --- */
        const MI_API_KEY = "2618ce8355bed488c07e92dd85339019";
        const BARCA_ID = 81;
        const BARCA_FEM_ID = 1557;

        // Funci√≥n para obtener datos (con cach√© de 1 hora)
        async function obtenerPartidos(teamId) {
            const nombreClave = `partidos_${teamId}`;
            const datosGuardados = localStorage.getItem(nombreClave);
            const UNA_HORA = 3600000;

            if (datosGuardados) {
                const cache = JSON.parse(datosGuardados);
                if (Date.now() - cache.timestamp < UNA_HORA) {
                    console.log(`Cargando equipo ${teamId} desde el ba√∫l üß≥`);
                    return cache.partidos;
                }
            }

            console.log(`Llamando a la API para el equipo ${teamId} üåê`);
            const url = `https://v3.football.api-sports.io/fixtures?team=${teamId}&next=5`;
            const respuesta = await fetch(url, {
                method: "GET",
                headers: { 
                    "x-rapidapi-key": MI_API_KEY, 
                    "x-rapidapi-host": "v3.football.api-sports.io" 
                }
            });
            const datos = await respuesta.json();
            
            localStorage.setItem(nombreClave, JSON.stringify({ 
                timestamp: Date.now(), 
                partidos: datos.response 
            }));
            return datos.response;
        }

        // Funci√≥n para dibujar los partidos en el HTML
        function renderizarPartidos(lista, elementoDestino, idEquipoPrincipal) {
            const esFem = idEquipoPrincipal === BARCA_FEM_ID;
            let html = `<h3>${esFem ? "Bar√ßa Femen√≠ üö∫" : "Bar√ßa Masculino üöπ"}</h3>`;
            
            const hoyISO = new Date().toISOString().split('T')[0];

            if (!lista || lista.length === 0) {
                html += "<p>No hay partidos programados.</p>";
            } else {
                lista.forEach(item => {
                    const rival = item.teams.home.id === idEquipoPrincipal ? item.teams.away : item.teams.home;
                    const fechaObj = new Date(item.fixture.date);
                    
                    const fechaFormateada = fechaObj.toLocaleDateString('es-ES', { 
                        day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' 
                    });
                    
                    // L√≥gica para detectar si es hoy
                    const fechaPartidoISO = fechaObj.toISOString().split('T')[0];
                    const esHoy = hoyISO === fechaPartidoISO;

                    // L√≥gica de cuenta atr√°s
                    const diferenciaMs = fechaObj - new Date();
                    const dias = Math.ceil(diferenciaMs / (1000 * 60 * 60 * 24));
                    
                    let msj = "";
                    if (esHoy) msj = "¬°Hoy juega el Bar√ßa! ‚öΩ";
                    else if (dias === 1) msj = "¬°Ma√±ana es el partido! üèüÔ∏è";
                    else msj = `Faltan ${dias} d√≠as`;

                    html += `
                        <div class="match-card ${esFem ? 'femenino' : ''} ${esHoy ? 'match-today' : ''}">
                            <div class="logo-container">
                                <img src="https://media.api-sports.io/football/teams/81.png" class="team-logo" alt="Bar√ßa">
                            </div>
                            <div class="match-info">
                                <div class="date-badge">${fechaFormateada}</div>
                                <div class="teams-line">Bar√ßa vs ${rival.name}</div>
                                <div class="venue-line">üìç ${item.fixture.venue.name || 'Estadio por confirmar'}</div>
                                <div class="countdown-text">${msj}</div>
                            </div>
                            <div class="logo-container">
                                <img src="${rival.logo}" class="team-logo" alt="${rival.name}">
                            </div>
                        </div>`;
                });
            }
            elementoDestino.innerHTML = html;
        }

        async function iniciarApp() {
            const mainContenedor = document.getElementById("partidos");
            mainContenedor.innerHTML = '<div id="masc-list"></div><div id="fem-list"></div>';

            try {
                const [masc, fem] = await Promise.all([
                    obtenerPartidos(BARCA_ID),
                    obtenerPartidos(BARCA_FEM_ID)
                ]);

                renderizarPartidos(masc, document.getElementById("masc-list"), BARCA_ID);
                renderizarPartidos(fem, document.getElementById("fem-list"), BARCA_FEM_ID);
            } catch (error) {
                console.error(error);
                mainContenedor.innerHTML = "<p>Hubo un problema al cargar los datos. Revisa la consola.</p>";
            }
        }

        document.addEventListener("DOMContentLoaded", iniciarApp);
    </script>
</body>
</html>